#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
// SPDX-License-Identifier: Apache-2.0
const sharrplaybook_construct_1 = require("../../../lib/sharrplaybook-construct");
const cdk_nag = require("cdk-nag");
const cdk = require("@aws-cdk/core");
require("source-map-support/register");
// SOLUTION_* - set by solution_env.sh
const SOLUTION_ID = process.env['SOLUTION_ID'] || 'undefined';
const SOLUTION_NAME = process.env['SOLUTION_NAME'] || 'undefined';
// DIST_* - set by build-s3-dist.sh
const DIST_VERSION = process.env['DIST_VERSION'] || '%%VERSION%%';
const DIST_OUTPUT_BUCKET = process.env['DIST_OUTPUT_BUCKET'] || '%%BUCKET%%';
const DIST_SOLUTION_NAME = process.env['DIST_SOLUTION_NAME'] || '%%SOLUTION%%';
const standardShortName = 'AFSBP';
const standardLongName = 'aws-foundational-security-best-practices';
const standardVersion = '1.0.0'; // DO NOT INCLUDE 'V'
const app = new cdk.App();
cdk.Aspects.of(app).add(new cdk_nag.AwsSolutionsChecks());
// Creates one rule per control Id. The Step Function determines what document to run based on
// Security Standard and Control Id. See afsbp-member-stack
const remediations = [
    { "control": 'AutoScaling.1' },
    { "control": 'CloudTrail.1' },
    { "control": 'CloudTrail.2' },
    { "control": 'CloudTrail.4' },
    { "control": 'CloudTrail.5' },
    { "control": 'CodeBuild.2' },
    { "control": 'Config.1' },
    { "control": 'EC2.1' },
    { "control": 'EC2.2' },
    { "control": 'EC2.6' },
    { "control": 'EC2.7' },
    { "control": 'IAM.3' },
    { "control": 'IAM.7' },
    { "control": 'IAM.8' },
    { "control": 'Lambda.1' },
    { "control": 'RDS.1' },
    { "control": 'RDS.2' },
    { "control": 'RDS.4' },
    { "control": 'RDS.5' },
    { "control": 'RDS.6' },
    { "control": 'RDS.7' },
    { "control": 'RDS.8' },
    { "control": 'RDS.13' },
    { "control": 'RDS.16' },
    { "control": 'Redshift.1' },
    { "control": 'Redshift.3' },
    { "control": 'Redshift.4' },
    { "control": 'Redshift.6' },
    { "control": 'S3.1' },
    { "control": 'S3.2' },
    {
        "control": 'S3.3',
        "executes": 'S3.2'
    },
    { "control": 'S3.4' },
    { "control": 'S3.5' },
    { "control": 'S3.6' },
    {
        "control": 'S3.8',
        "executes": 'S3.2'
    }
];
const adminStack = new sharrplaybook_construct_1.PlaybookPrimaryStack(app, 'AFSBPStack', {
    description: `(${SOLUTION_ID}P) ${SOLUTION_NAME} ${standardShortName} ${standardVersion} Compliance Pack - Admin Account, ${DIST_VERSION}`,
    solutionId: SOLUTION_ID,
    solutionVersion: DIST_VERSION,
    solutionDistBucket: DIST_OUTPUT_BUCKET,
    solutionDistName: DIST_SOLUTION_NAME,
    remediations: remediations,
    securityStandardLongName: standardLongName,
    securityStandard: standardShortName,
    securityStandardVersion: standardVersion
});
const memberStack = new sharrplaybook_construct_1.PlaybookMemberStack(app, 'AFSBPMemberStack', {
    description: `(${SOLUTION_ID}C) ${SOLUTION_NAME} ${standardShortName} ${standardVersion} Compliance Pack - Member Account, ${DIST_VERSION}`,
    solutionId: SOLUTION_ID,
    solutionVersion: DIST_VERSION,
    solutionDistBucket: DIST_OUTPUT_BUCKET,
    securityStandard: standardShortName,
    securityStandardVersion: standardVersion,
    securityStandardLongName: standardLongName,
    remediations: remediations
});
adminStack.templateOptions.templateFormatVersion = "2010-09-09";
memberStack.templateOptions.templateFormatVersion = "2010-09-09";
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWZzYnAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhZnNicC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSxxRUFBcUU7QUFDckUsc0NBQXNDO0FBQ3RDLGtGQUk4QztBQUM5QyxtQ0FBbUM7QUFDbkMscUNBQXFDO0FBQ3JDLHVDQUFxQztBQUVyQyxzQ0FBc0M7QUFDdEMsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsSUFBSSxXQUFXLENBQUM7QUFDOUQsTUFBTSxhQUFhLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsSUFBSSxXQUFXLENBQUM7QUFDbEUsbUNBQW1DO0FBQ25DLE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLElBQUksYUFBYSxDQUFDO0FBQ2xFLE1BQU0sa0JBQWtCLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLFlBQVksQ0FBQztBQUM3RSxNQUFNLGtCQUFrQixHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLENBQUMsSUFBSSxjQUFjLENBQUM7QUFFL0UsTUFBTSxpQkFBaUIsR0FBRyxPQUFPLENBQUM7QUFDbEMsTUFBTSxnQkFBZ0IsR0FBRywwQ0FBMEMsQ0FBQztBQUNwRSxNQUFNLGVBQWUsR0FBRyxPQUFPLENBQUMsQ0FBQyxxQkFBcUI7QUFFdEQsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7QUFDMUIsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksT0FBTyxDQUFDLGtCQUFrQixFQUFFLENBQUMsQ0FBQztBQUUxRCw4RkFBOEY7QUFDOUYsMkRBQTJEO0FBQzNELE1BQU0sWUFBWSxHQUFlO0lBQy9CLEVBQUUsU0FBUyxFQUFFLGVBQWUsRUFBRTtJQUM5QixFQUFFLFNBQVMsRUFBRSxjQUFj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cUJBQXFCLEdBQUcsWUFBWSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiIyEvdXNyL2Jpbi9lbnYgbm9kZVxuLy8gQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4vLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuaW1wb3J0IHtcbiAgUGxheWJvb2tQcmltYXJ5U3RhY2ssXG4gIFBsYXlib29rTWVtYmVyU3RhY2ssXG4gIElDb250cm9sXG59IGZyb20gJy4uLy4uLy4uL2xpYi9zaGFycnBsYXlib29rLWNvbnN0cnVjdCc7XG5pbXBvcnQgKiBhcyBjZGtfbmFnIGZyb20gJ2Nkay1uYWcnO1xuaW1wb3J0ICogYXMgY2RrIGZyb20gJ0Bhd3MtY2RrL2NvcmUnO1xuaW1wb3J0ICdzb3VyY2UtbWFwLXN1cHBvcnQvcmVnaXN0ZXInO1xuXG4vLyBTT0xVVElPTl8qIC0gc2V0IGJ5IHNvbHV0aW9uX2Vudi5zaFxuY29uc3QgU09MVVRJT05fSUQgPSBwcm9jZXNzLmVudlsnU09MVVRJT05fSUQnXSB8fCAndW5kZWZpbmVkJztcbmNvbnN0IFNPTFVUSU9OX05BTUUgPSBwcm9jZXNzLmVudlsnU09MVVRJT05fTkFNRSddIHx8ICd1bmRlZmluZWQnO1xuLy8gRElTVF8qIC0gc2V0IGJ5IGJ1aWxkLXMzLWRpc3Quc2hcbmNvbnN0IERJU1RfVkVSU0lPTiA9IHByb2Nlc3MuZW52WydESVNUX1ZFUlNJT04nXSB8fCAnJSVWRVJTSU9OJSUnO1xuY29uc3QgRElTVF9PVVRQVVRfQlVDS0VUID0gcHJvY2Vzcy5lbnZbJ0RJU1RfT1VUUFVUX0JVQ0tFVCddIHx8ICclJUJVQ0tFVCUlJztcbmNvbnN0IERJU1RfU09MVVRJT05fTkFNRSA9IHByb2Nlc3MuZW52WydESVNUX1NPTFVUSU9OX05BTUUnXSB8fCAnJSVTT0xVVElPTiUlJztcblxuY29uc3Qgc3RhbmRhcmRTaG9ydE5hbWUgPSAnQUZTQlAnO1xuY29uc3Qgc3RhbmRhcmRMb25nTmFtZSA9ICdhd3MtZm91bmRhdGlvbmFsLXNlY3VyaXR5LWJlc3QtcHJhY3RpY2VzJztcbmNvbnN0IHN0YW5kYXJkVmVyc2lvbiA9ICcxLjAuMCc7IC8vIERPIE5PVCBJTkNMVURFICdWJ1xuXG5jb25zdCBhcHAgPSBuZXcgY2RrLkFwcCgpO1xuY2RrLkFzcGVjdHMub2YoYXBwKS5hZGQobmV3IGNka19uYWcuQXdzU29sdXRpb25zQ2hlY2tzKCkpO1xuXG4vLyBDcmVhdGVzIG9uZSBydWxlIHBlciBjb250cm9sIElkLiBUaGUgU3RlcCBGdW5jdGlvbiBkZXRlcm1pbmVzIHdoYXQgZG9jdW1lbnQgdG8gcnVuIGJhc2VkIG9uXG4vLyBTZWN1cml0eSBTdGFuZGFyZCBhbmQgQ29udHJvbCBJZC4gU2VlIGFmc2JwLW1lbWJlci1zdGFja1xuY29uc3QgcmVtZWRpYXRpb25zOiBJQ29udHJvbFtdID0gW1xuICB7IFwiY29udHJvbFwiOiAnQXV0b1NjYWxpbmcuMScgfSxcbiAgeyBcImNvbnRyb2xcIjogJ0Nsb3VkVHJhaWwuMScgfSxcbiAgeyBcImNvbnRyb2xcIjogJ0Nsb3VkVHJhaWwuMicgfSxcbiAgeyBcImNvbnRyb2xcIjogJ0Nsb3VkVHJhaWwuNCcgfSxcbiAgeyBcImNvbnRyb2xcIjogJ0Nsb3VkVHJhaWwuNScgfSxcbiAgeyBcImNvbnRyb2xcIjogJ0NvZGVCdWlsZC4yJyB9LFxuICB7IFwiY29udHJvbFwiOiAnQ29uZmlnLjEnIH0sXG4gIHsgXCJjb250cm9sXCI6ICdFQzIuMScgfSxcbiAgeyBcImNvbnRyb2xcIjogJ0VDMi4yJyB9LFxuICB7IFwiY29udHJvbFwiOiAnRUMyLjYnIH0sXG4gIHsgXCJjb250cm9sXCI6ICdFQzIuNycgfSxcbiAgeyBcImNvbnRyb2xcIjogJ0lBTS4zJyB9LFxuICB7IFwiY29udHJvbFwiOiAnSUFNLjcnIH0sXG4gIHsgXCJjb250cm9sXCI6ICdJQU0uOCcgfSxcbiAgeyBcImNvbnRyb2xcIjogJ0xhbWJkYS4xJyB9LFxuICB7IFwiY29udHJvbFwiOiAnUkRTLjEnIH0sXG4gIHsgXCJjb250cm9sXCI6ICdSRFMuMicgfSxcbiAgeyBcImNvbnRyb2xcIjogJ1JEUy40JyB9LFxuICB7IFwiY29udHJvbFwiOiAnUkRTLjUnIH0sXG4gIHsgXCJjb250cm9sXCI6ICdSRFMuNicgfSxcbiAgeyBcImNvbnRyb2xcIjogJ1JEUy43JyB9LFxuICB7IFwiY29udHJvbFwiOiAnUkRTLjgnIH0sXG4gIHsgXCJjb250cm9sXCI6ICdSRFMuMTMnIH0sXG4gIHsgXCJjb250cm9sXCI6ICdSRFMuMTYnIH0sXG4gIHsgXCJjb250cm9sXCI6ICdSZWRzaGlmdC4xJyB9LFxuICB7IFwiY29udHJvbFwiOiAnUmVkc2hpZnQuMycgfSxcbiAgeyBcImNvbnRyb2xcIjogJ1JlZHNoaWZ0LjQnIH0sXG4gIHsgXCJjb250cm9sXCI6ICdSZWRzaGlmdC42JyB9LFxuICB7IFwiY29udHJvbFwiOiAnUzMuMScgfSxcbiAgeyBcImNvbnRyb2xcIjogJ1MzLjInIH0sXG4gIHtcbiAgICBcImNvbnRyb2xcIjogJ1MzLjMnLFxuICAgIFwiZXhlY3V0ZXNcIjogJ1MzLjInXG4gIH0sXG4gIHsgXCJjb250cm9sXCI6ICdTMy40JyB9LFxuICB7IFwiY29udHJvbFwiOiAnUzMuNScgfSxcbiAgeyBcImNvbnRyb2xcIjogJ1MzLjYnIH0sXG4gIHtcbiAgICBcImNvbnRyb2xcIjogJ1MzLjgnLFxuICAgIFwiZXhlY3V0ZXNcIjogJ1MzLjInXG4gIH1cbl07XG5cbmNvbnN0IGFkbWluU3RhY2sgPSBuZXcgUGxheWJvb2tQcmltYXJ5U3RhY2soYXBwLCAnQUZTQlBTdGFjaycsIHtcbiAgZGVzY3JpcHRpb246IGAoJHtTT0xVVElPTl9JRH1QKSAke1NPTFVUSU9OX05BTUV9ICR7c3RhbmRhcmRTaG9ydE5hbWV9ICR7c3RhbmRhcmRWZXJzaW9ufSBDb21wbGlhbmNlIFBhY2sgLSBBZG1pbiBBY2NvdW50LCAke0RJU1RfVkVSU0lPTn1gLFxuICBzb2x1dGlvbklkOiBTT0xVVElPTl9JRCxcbiAgc29sdXRpb25WZXJzaW9uOiBESVNUX1ZFUlNJT04sXG4gIHNvbHV0aW9uRGlzdEJ1Y2tldDogRElTVF9PVVRQVVRfQlVDS0VULFxuICBzb2x1dGlvbkRpc3ROYW1lOiBESVNUX1NPTFVUSU9OX05BTUUsXG4gIHJlbWVkaWF0aW9uczogcmVtZWRpYXRpb25zLFxuICBzZWN1cml0eVN0YW5kYXJkTG9uZ05hbWU6IHN0YW5kYXJkTG9uZ05hbWUsXG4gIHNlY3VyaXR5U3RhbmRhcmQ6IHN0YW5kYXJkU2hvcnROYW1lLFxuICBzZWN1cml0eVN0YW5kYXJkVmVyc2lvbjogc3RhbmRhcmRWZXJzaW9uXG59KTtcblxuY29uc3QgbWVtYmVyU3RhY2sgPSBuZXcgUGxheWJvb2tNZW1iZXJTdGFjayhhcHAsICdBRlNCUE1lbWJlclN0YWNrJywge1xuICBkZXNjcmlwdGlvbjogYCgke1NPTFVUSU9OX0lEfUMpICR7U09MVVRJT05fTkFNRX0gJHtzdGFuZGFyZFNob3J0TmFtZX0gJHtzdGFuZGFyZFZlcnNpb259IENvbXBsaWFuY2UgUGFjayAtIE1lbWJlciBBY2NvdW50LCAke0RJU1RfVkVSU0lPTn1gLFxuICBzb2x1dGlvbklkOiBTT0xVVElPTl9JRCxcbiAgc29sdXRpb25WZXJzaW9uOiBESVNUX1ZFUlNJT04sXG4gIHNvbHV0aW9uRGlzdEJ1Y2tldDogRElTVF9PVVRQVVRfQlVDS0VULFxuICBzZWN1cml0eVN0YW5kYXJkOiBzdGFuZGFyZFNob3J0TmFtZSxcbiAgc2VjdXJpdHlTdGFuZGFyZFZlcnNpb246IHN0YW5kYXJkVmVyc2lvbixcbiAgc2VjdXJpdHlTdGFuZGFyZExvbmdOYW1lOiBzdGFuZGFyZExvbmdOYW1lLFxuICByZW1lZGlhdGlvbnM6IHJlbWVkaWF0aW9uc1xufSk7XG5cbmFkbWluU3RhY2sudGVtcGxhdGVPcHRpb25zLnRlbXBsYXRlRm9ybWF0VmVyc2lvbiA9IFwiMjAxMC0wOS0wOVwiO1xubWVtYmVyU3RhY2sudGVtcGxhdGVPcHRpb25zLnRlbXBsYXRlRm9ybWF0VmVyc2lvbiA9IFwiMjAxMC0wOS0wOVwiO1xuIl19