#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
// SPDX-License-Identifier: Apache-2.0
const sharrplaybook_construct_1 = require("../../../lib/sharrplaybook-construct");
const cdk_nag = require("cdk-nag");
const cdk = require("@aws-cdk/core");
require("source-map-support/register");
// SOLUTION_* - set by solution_env.sh
const SOLUTION_ID = process.env['SOLUTION_ID'] || 'undefined';
const SOLUTION_NAME = process.env['SOLUTION_NAME'] || 'undefined';
// DIST_* - set by build-s3-dist.sh
const DIST_VERSION = process.env['DIST_VERSION'] || '%%VERSION%%';
const DIST_OUTPUT_BUCKET = process.env['DIST_OUTPUT_BUCKET'] || '%%BUCKET%%';
const DIST_SOLUTION_NAME = process.env['DIST_SOLUTION_NAME'] || '%%SOLUTION%%';
const standardShortName = 'PCI';
const standardLongName = 'pci-dss';
const standardVersion = '3.2.1'; // DO NOT INCLUDE 'V'
const app = new cdk.App();
cdk.Aspects.of(app).add(new cdk_nag.AwsSolutionsChecks());
// Creates one rule per control Id. The Step Function determines what document to run based on
// Security Standard and Control Id. See cis-member-stack
const remediations = [
    { "control": "PCI.AutoScaling.1" },
    { "control": "PCI.IAM.7" },
    { "control": "PCI.CloudTrail.2" },
    { "control": "PCI.CodeBuild.2" },
    { "control": "PCI.CW.1" },
    { "control": "PCI.EC2.1" },
    { "control": "PCI.EC2.2" },
    { "control": "PCI.EC2.5" },
    { "control": "PCI.IAM.8" },
    { "control": "PCI.KMS.1" },
    { "control": "PCI.Lambda.1" },
    { "control": "PCI.RDS.1" },
    { "control": "PCI.RDS.2" },
    { "control": "PCI.Redshift.1" },
    { "control": "PCI.CloudTrail.1" },
    { "control": "PCI.EC2.6" },
    { "control": "PCI.CloudTrail.3" },
    { "control": "PCI.CloudTrail.4" },
    { "control": "PCI.Config.1" },
    { "control": "PCI.S3.1" },
    {
        "control": "PCI.S3.2",
        "executes": "PCI.S3.1"
    },
    { "control": "PCI.S3.4" },
    { "control": "PCI.S3.5" },
    { "control": "PCI.S3.6" }
];
const adminStack = new sharrplaybook_construct_1.PlaybookPrimaryStack(app, 'PCI321Stack', {
    description: `(${SOLUTION_ID}P) ${SOLUTION_NAME} ${standardShortName} ${standardVersion} Compliance Pack - Admin Account, ${DIST_VERSION}`,
    solutionId: SOLUTION_ID,
    solutionVersion: DIST_VERSION,
    solutionDistBucket: DIST_OUTPUT_BUCKET,
    solutionDistName: DIST_SOLUTION_NAME,
    remediations: remediations,
    securityStandardLongName: standardLongName,
    securityStandard: standardShortName,
    securityStandardVersion: standardVersion
});
const memberStack = new sharrplaybook_construct_1.PlaybookMemberStack(app, 'PCI321MemberStack', {
    description: `(${SOLUTION_ID}C) ${SOLUTION_NAME} ${standardShortName} ${standardVersion} Compliance Pack - Member Account, ${DIST_VERSION}`,
    solutionId: SOLUTION_ID,
    solutionVersion: DIST_VERSION,
    solutionDistBucket: DIST_OUTPUT_BUCKET,
    securityStandard: standardShortName,
    securityStandardVersion: standardVersion,
    securityStandardLongName: standardLongName,
    remediations: remediations
});
adminStack.templateOptions.templateFormatVersion = "2010-09-09";
memberStack.templateOptions.templateFormatVersion = "2010-09-09";
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGNpMzIxLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicGNpMzIxLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLHFFQUFxRTtBQUNyRSxzQ0FBc0M7QUFDdEMsa0ZBSThDO0FBQzlDLG1DQUFtQztBQUNuQyxxQ0FBcUM7QUFDckMsdUNBQXFDO0FBRXJDLHNDQUFzQztBQUN0QyxNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxJQUFJLFdBQVcsQ0FBQztBQUM5RCxNQUFNLGFBQWEsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxJQUFJLFdBQVcsQ0FBQztBQUNsRSxtQ0FBbUM7QUFDbkMsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsSUFBSSxhQUFhLENBQUM7QUFDbEUsTUFBTSxrQkFBa0IsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixDQUFDLElBQUksWUFBWSxDQUFDO0FBQzdFLE1BQU0sa0JBQWtCLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLGNBQWMsQ0FBQztBQUUvRSxNQUFNLGlCQUFpQixHQUFHLEtBQUssQ0FBQztBQUNoQyxNQUFNLGdCQUFnQixHQUFHLFNBQVMsQ0FBQztBQUNuQyxNQUFNLGVBQWUsR0FBRyxPQUFPLENBQUMsQ0FBQyxxQkFBcUI7QUFFdEQsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7QUFDMUIsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksT0FBTyxDQUFDLGtCQUFrQixFQUFFLENBQUMsQ0FBQztBQUUxRCw4RkFBOEY7QUFDOUYseURBQXlEO0FBQ3pELE1BQU0sWUFBWSxHQUFlO0lBQy9CLEVBQUUsU0FBUyxFQUFFLG1CQUFtQixFQUFFO0lBQ2xDLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRTtJQUMxQixFQUFFLFNBQVMsRUFBRSxrQkFBa0IsRUFBRTtJQUNqQyxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRTtJQUNoQyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUU7SUFDekIsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFO0lBQzFCLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRTtJQUMxQixFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUU7SUFDMUIsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFO0lBQzFCLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRTtJQUMxQixFQUFFLFNBQVMsRUFBRSxjQUFjLEVBQUU7SUFDN0IsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFO0lBQzFCLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRTtJQUMxQixFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRTtJQUMvQixFQUFFLFNBQVMsRUFBRSxrQkFBa0IsRUFBRTtJQUNqQyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUU7SUFDMUIsRUFBRSxTQUFTLEVBQUUsa0JBQWtCLEVBQUU7SUFDakMsRUFBRSxTQUFTLEVBQUUsa0JBQWtCLEVBQUU7SUFDakMsRUFBRSxTQUFTLEVBQUUsY0FBYyxFQUFFO0lBQzdCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRTtJQUN6QjtRQUNFLFNBQVMsRUFBRSxVQUFVO1FBQ3JCLFVBQVUsRUFBRSxVQUFVO0tBQ3ZCO0lBQ0QsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFO0lBQ3pCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRTtJQUN6QixFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUU7Q0FDMUIsQ0FBQztBQUVGLE1BQU0sVUFBVSxHQUFHLElBQUksOENBQW9CLENBQUMsR0FBRyxFQUFFLGFBQWEsRUFBRTtJQUM5RCxXQUFXLEVBQUUsSUFBSSxXQUFXLE1BQU0sYUFBYSxJQUFJLGlCQUFpQixJQUFJLGVBQWUscUNBQXFDLFlBQVksRUFBRTtJQUMxSSxVQUFVLEVBQUUsV0FBVztJQUN2QixlQUFlLEVBQUUsWUFBWTtJQUM3QixrQkFBa0IsRUFBRSxrQkFBa0I7SUFDdEMsZ0JBQWdCLEVBQUUsa0JBQWtCO0lBQ3BDLFlBQVksRUFBRSxZQUFZO0lBQzFCLHdCQUF3QixFQUFFLGdCQUFnQjtJQUMxQyxnQkFBZ0IsRUFBRSxpQkFBaUI7SUFDbkMsdUJBQXVCLEVBQUUsZUFBZTtDQUN6QyxDQUFDLENBQUM7QUFFSCxNQUFNLFdBQVcsR0FBRyxJQUFJLDZDQUFtQixDQUFDLEdBQUcsRUFBRSxtQkFBbUIsRUFBRTtJQUNwRSxXQUFXLEVBQUUsSUFBSSxXQUFXLE1BQU0sYUFBYSxJQUFJLGlCQUFpQixJQUFJLGVBQWUsc0NBQXNDLFlBQVksRUFBRTtJQUMzSSxVQUFVLEVBQUUsV0FBVztJQUN2QixlQUFlLEVBQUUsWUFBWTtJQUM3QixrQkFBa0IsRUFBRSxrQkFBa0I7SUFDdEMsZ0JBQWdCLEVBQUUsaUJBQWlCO0lBQ25DLHVCQUF1QixFQUFFLGVBQWU7SUFDeEMsd0JBQXdCLEVBQUUsZ0JBQWdCO0lBQzFDLFlBQVksRUFBRSxZQUFZO0NBQzNCLENBQUMsQ0FBQztBQUVILFVBQVUsQ0FBQyxlQUFlLENBQUMscUJBQXFCLEdBQUcsWUFBWSxDQUFDO0FBQ2hFLFdBQVcsQ0FBQyxlQUFlLENBQUMscUJBQXFCLEdBQUcsWUFBWSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiIyEvdXNyL2Jpbi9lbnYgbm9kZVxuLy8gQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4vLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuaW1wb3J0IHtcbiAgUGxheWJvb2tQcmltYXJ5U3RhY2ssXG4gIFBsYXlib29rTWVtYmVyU3RhY2ssXG4gIElDb250cm9sXG59IGZyb20gJy4uLy4uLy4uL2xpYi9zaGFycnBsYXlib29rLWNvbnN0cnVjdCc7XG5pbXBvcnQgKiBhcyBjZGtfbmFnIGZyb20gJ2Nkay1uYWcnO1xuaW1wb3J0ICogYXMgY2RrIGZyb20gJ0Bhd3MtY2RrL2NvcmUnO1xuaW1wb3J0ICdzb3VyY2UtbWFwLXN1cHBvcnQvcmVnaXN0ZXInO1xuXG4vLyBTT0xVVElPTl8qIC0gc2V0IGJ5IHNvbHV0aW9uX2Vudi5zaFxuY29uc3QgU09MVVRJT05fSUQgPSBwcm9jZXNzLmVudlsnU09MVVRJT05fSUQnXSB8fCAndW5kZWZpbmVkJztcbmNvbnN0IFNPTFVUSU9OX05BTUUgPSBwcm9jZXNzLmVudlsnU09MVVRJT05fTkFNRSddIHx8ICd1bmRlZmluZWQnO1xuLy8gRElTVF8qIC0gc2V0IGJ5IGJ1aWxkLXMzLWRpc3Quc2hcbmNvbnN0IERJU1RfVkVSU0lPTiA9IHByb2Nlc3MuZW52WydESVNUX1ZFUlNJT04nXSB8fCAnJSVWRVJTSU9OJSUnO1xuY29uc3QgRElTVF9PVVRQVVRfQlVDS0VUID0gcHJvY2Vzcy5lbnZbJ0RJU1RfT1VUUFVUX0JVQ0tFVCddIHx8ICclJUJVQ0tFVCUlJztcbmNvbnN0IERJU1RfU09MVVRJT05fTkFNRSA9IHByb2Nlc3MuZW52WydESVNUX1NPTFVUSU9OX05BTUUnXSB8fCAnJSVTT0xVVElPTiUlJztcblxuY29uc3Qgc3RhbmRhcmRTaG9ydE5hbWUgPSAnUENJJztcbmNvbnN0IHN0YW5kYXJkTG9uZ05hbWUgPSAncGNpLWRzcyc7XG5jb25zdCBzdGFuZGFyZFZlcnNpb24gPSAnMy4yLjEnOyAvLyBETyBOT1QgSU5DTFVERSAnVidcblxuY29uc3QgYXBwID0gbmV3IGNkay5BcHAoKTtcbmNkay5Bc3BlY3RzLm9mKGFwcCkuYWRkKG5ldyBjZGtfbmFnLkF3c1NvbHV0aW9uc0NoZWNrcygpKTtcblxuLy8gQ3JlYXRlcyBvbmUgcnVsZSBwZXIgY29udHJvbCBJZC4gVGhlIFN0ZXAgRnVuY3Rpb24gZGV0ZXJtaW5lcyB3aGF0IGRvY3VtZW50IHRvIHJ1biBiYXNlZCBvblxuLy8gU2VjdXJpdHkgU3RhbmRhcmQgYW5kIENvbnRyb2wgSWQuIFNlZSBjaXMtbWVtYmVyLXN0YWNrXG5jb25zdCByZW1lZGlhdGlvbnM6IElDb250cm9sW10gPSBbXG4gIHsgXCJjb250cm9sXCI6IFwiUENJLkF1dG9TY2FsaW5nLjFcIiB9LFxuICB7IFwiY29udHJvbFwiOiBcIlBDSS5JQU0uN1wiIH0sXG4gIHsgXCJjb250cm9sXCI6IFwiUENJLkNsb3VkVHJhaWwuMlwiIH0sXG4gIHsgXCJjb250cm9sXCI6IFwiUENJLkNvZGVCdWlsZC4yXCIgfSxcbiAgeyBcImNvbnRyb2xcIjogXCJQQ0kuQ1cuMVwiIH0sXG4gIHsgXCJjb250cm9sXCI6IFwiUENJLkVDMi4xXCIgfSxcbiAgeyBcImNvbnRyb2xcIjogXCJQQ0kuRUMyLjJcIiB9LFxuICB7IFwiY29udHJvbFwiOiBcIlBDSS5FQzIuNVwiIH0sXG4gIHsgXCJjb250cm9sXCI6IFwiUENJLklBTS44XCIgfSxcbiAgeyBcImNvbnRyb2xcIjogXCJQQ0kuS01TLjFcIiB9LFxuICB7IFwiY29udHJvbFwiOiBcIlBDSS5MYW1iZGEuMVwiIH0sXG4gIHsgXCJjb250cm9sXCI6IFwiUENJLlJEUy4xXCIgfSxcbiAgeyBcImNvbnRyb2xcIjogXCJQQ0kuUkRTLjJcIiB9LFxuICB7IFwiY29udHJvbFwiOiBcIlBDSS5SZWRzaGlmdC4xXCIgfSxcbiAgeyBcImNvbnRyb2xcIjogXCJQQ0kuQ2xvdWRUcmFpbC4xXCIgfSxcbiAgeyBcImNvbnRyb2xcIjogXCJQQ0kuRUMyLjZcIiB9LFxuICB7IFwiY29udHJvbFwiOiBcIlBDSS5DbG91ZFRyYWlsLjNcIiB9LFxuICB7IFwiY29udHJvbFwiOiBcIlBDSS5DbG91ZFRyYWlsLjRcIiB9LFxuICB7IFwiY29udHJvbFwiOiBcIlBDSS5Db25maWcuMVwiIH0sXG4gIHsgXCJjb250cm9sXCI6IFwiUENJLlMzLjFcIiB9LFxuICB7XG4gICAgXCJjb250cm9sXCI6IFwiUENJLlMzLjJcIixcbiAgICBcImV4ZWN1dGVzXCI6IFwiUENJLlMzLjFcIlxuICB9LFxuICB7IFwiY29udHJvbFwiOiBcIlBDSS5TMy40XCIgfSxcbiAgeyBcImNvbnRyb2xcIjogXCJQQ0kuUzMuNVwiIH0sXG4gIHsgXCJjb250cm9sXCI6IFwiUENJLlMzLjZcIiB9XG5dO1xuXG5jb25zdCBhZG1pblN0YWNrID0gbmV3IFBsYXlib29rUHJpbWFyeVN0YWNrKGFwcCwgJ1BDSTMyMVN0YWNrJywge1xuICBkZXNjcmlwdGlvbjogYCgke1NPTFVUSU9OX0lEfVApICR7U09MVVRJT05fTkFNRX0gJHtzdGFuZGFyZFNob3J0TmFtZX0gJHtzdGFuZGFyZFZlcnNpb259IENvbXBsaWFuY2UgUGFjayAtIEFkbWluIEFjY291bnQsICR7RElTVF9WRVJTSU9OfWAsXG4gIHNvbHV0aW9uSWQ6IFNPTFVUSU9OX0lELFxuICBzb2x1dGlvblZlcnNpb246IERJU1RfVkVSU0lPTixcbiAgc29sdXRpb25EaXN0QnVja2V0OiBESVNUX09VVFBVVF9CVUNLRVQsXG4gIHNvbHV0aW9uRGlzdE5hbWU6IERJU1RfU09MVVRJT05fTkFNRSxcbiAgcmVtZWRpYXRpb25zOiByZW1lZGlhdGlvbnMsXG4gIHNlY3VyaXR5U3RhbmRhcmRMb25nTmFtZTogc3RhbmRhcmRMb25nTmFtZSxcbiAgc2VjdXJpdHlTdGFuZGFyZDogc3RhbmRhcmRTaG9ydE5hbWUsXG4gIHNlY3VyaXR5U3RhbmRhcmRWZXJzaW9uOiBzdGFuZGFyZFZlcnNpb25cbn0pO1xuXG5jb25zdCBtZW1iZXJTdGFjayA9IG5ldyBQbGF5Ym9va01lbWJlclN0YWNrKGFwcCwgJ1BDSTMyMU1lbWJlclN0YWNrJywge1xuICBkZXNjcmlwdGlvbjogYCgke1NPTFVUSU9OX0lEfUMpICR7U09MVVRJT05fTkFNRX0gJHtzdGFuZGFyZFNob3J0TmFtZX0gJHtzdGFuZGFyZFZlcnNpb259IENvbXBsaWFuY2UgUGFjayAtIE1lbWJlciBBY2NvdW50LCAke0RJU1RfVkVSU0lPTn1gLFxuICBzb2x1dGlvbklkOiBTT0xVVElPTl9JRCxcbiAgc29sdXRpb25WZXJzaW9uOiBESVNUX1ZFUlNJT04sXG4gIHNvbHV0aW9uRGlzdEJ1Y2tldDogRElTVF9PVVRQVVRfQlVDS0VULFxuICBzZWN1cml0eVN0YW5kYXJkOiBzdGFuZGFyZFNob3J0TmFtZSxcbiAgc2VjdXJpdHlTdGFuZGFyZFZlcnNpb246IHN0YW5kYXJkVmVyc2lvbixcbiAgc2VjdXJpdHlTdGFuZGFyZExvbmdOYW1lOiBzdGFuZGFyZExvbmdOYW1lLFxuICByZW1lZGlhdGlvbnM6IHJlbWVkaWF0aW9uc1xufSk7XG5cbmFkbWluU3RhY2sudGVtcGxhdGVPcHRpb25zLnRlbXBsYXRlRm9ybWF0VmVyc2lvbiA9IFwiMjAxMC0wOS0wOVwiO1xubWVtYmVyU3RhY2sudGVtcGxhdGVPcHRpb25zLnRlbXBsYXRlRm9ybWF0VmVyc2lvbiA9IFwiMjAxMC0wOS0wOVwiO1xuIl19