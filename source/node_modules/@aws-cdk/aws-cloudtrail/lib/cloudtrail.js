"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.DataResourceType = exports.ManagementEventSources = exports.Trail = exports.ReadWriteType = void 0;
const jsiiDeprecationWarnings = require("../.warnings.jsii.js");
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const events = require("@aws-cdk/aws-events");
const iam = require("@aws-cdk/aws-iam");
const logs = require("@aws-cdk/aws-logs");
const s3 = require("@aws-cdk/aws-s3");
const core_1 = require("@aws-cdk/core");
const cloudtrail_generated_1 = require("./cloudtrail.generated");
/**
 * Types of events that CloudTrail can log
 */
var ReadWriteType;
(function (ReadWriteType) {
    /**
     * Read-only events include API operations that read your resources,
     * but don't make changes.
     * For example, read-only events include the Amazon EC2 DescribeSecurityGroups
     * and DescribeSubnets API operations.
     */
    ReadWriteType["READ_ONLY"] = "ReadOnly";
    /**
     * Write-only events include API operations that modify (or might modify)
     * your resources.
     * For example, the Amazon EC2 RunInstances and TerminateInstances API
     * operations modify your instances.
     */
    ReadWriteType["WRITE_ONLY"] = "WriteOnly";
    /**
     * All events
     */
    ReadWriteType["ALL"] = "All";
    /**
     * No events
     */
    ReadWriteType["NONE"] = "None";
})(ReadWriteType = exports.ReadWriteType || (exports.ReadWriteType = {}));
/**
 * Cloud trail allows you to log events that happen in your AWS account
 * For example:
 *
 * import { CloudTrail } from '@aws-cdk/aws-cloudtrail'
 *
 * const cloudTrail = new CloudTrail(this, 'MyTrail');
 *
 * NOTE the above example creates an UNENCRYPTED bucket by default,
 * If you are required to use an Encrypted bucket you can supply a preconfigured bucket
 * via TrailProps
 *
 */
class Trail extends core_1.Resource {
    constructor(scope, id, props = {}) {
        super(scope, id, {
            physicalName: props.trailName,
        });
        this.eventSelectors = [];
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_cloudtrail_TrailProps(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, Trail);
            }
            throw error;
        }
        const cloudTrailPrincipal = new iam.ServicePrincipal('cloudtrail.amazonaws.com');
        this.s3bucket = props.bucket || new s3.Bucket(this, 'S3', { encryption: s3.BucketEncryption.UNENCRYPTED, enforceSSL: true });
        this.s3bucket.addToResourcePolicy(new iam.PolicyStatement({
            resources: [this.s3bucket.bucketArn],
            actions: ['s3:GetBucketAcl'],
            principals: [cloudTrailPrincipal],
        }));
        this.s3bucket.addToResourcePolicy(new iam.PolicyStatement({
            resources: [this.s3bucket.arnForObjects(`${props.s3KeyPrefix ? `${props.s3KeyPrefix}/` : ''}AWSLogs/${core_1.Stack.of(this).account}/*`)],
            actions: ['s3:PutObject'],
            principals: [cloudTrailPrincipal],
            conditions: {
                StringEquals: { 's3:x-amz-acl': 'bucket-owner-full-control' },
            },
        }));
        this.topic = props.snsTopic;
        if (this.topic) {
            this.topic.grantPublish(cloudTrailPrincipal);
        }
        let logsRole;
        if (props.sendToCloudWatchLogs) {
            if (props.cloudWatchLogGroup) {
                this.logGroup = props.cloudWatchLogGroup;
            }
            else {
                this.logGroup = new logs.LogGroup(this, 'LogGroup', {
                    retention: props.cloudWatchLogsRetention ?? logs.RetentionDays.ONE_YEAR,
                });
            }
            logsRole = new iam.Role(this, 'LogsRole', { assumedBy: cloudTrailPrincipal });
            logsRole.addToPrincipalPolicy(new iam.PolicyStatement({
                actions: ['logs:PutLogEvents', 'logs:CreateLogStream'],
                resources: [this.logGroup.logGroupArn],
            }));
        }
        if (props.managementEvents) {
            let managementEvent;
            if (props.managementEvents === ReadWriteType.NONE) {
                managementEvent = {
                    includeManagementEvents: false,
                };
            }
            else {
                managementEvent = {
                    includeManagementEvents: true,
                    readWriteType: props.managementEvents,
                };
            }
            this.eventSelectors.push(managementEvent);
        }
        if (props.kmsKey && props.encryptionKey) {
            throw new Error('Both kmsKey and encryptionKey must not be specified. Use only encryptionKey');
        }
        // TODO: not all regions support validation. Use service configuration data to fail gracefully
        const trail = new cloudtrail_generated_1.CfnTrail(this, 'Resource', {
            isLogging: true,
            enableLogFileValidation: props.enableFileValidation == null ? true : props.enableFileValidation,
            isMultiRegionTrail: props.isMultiRegionTrail == null ? true : props.isMultiRegionTrail,
            includeGlobalServiceEvents: props.includeGlobalServiceEvents == null ? true : props.includeGlobalServiceEvents,
            trailName: this.physicalName,
            kmsKeyId: props.encryptionKey?.keyArn ?? props.kmsKey?.keyArn,
            s3BucketName: this.s3bucket.bucketName,
            s3KeyPrefix: props.s3KeyPrefix,
            cloudWatchLogsLogGroupArn: this.logGroup?.logGroupArn,
            cloudWatchLogsRoleArn: logsRole?.roleArn,
            snsTopicName: this.topic?.topicName,
            eventSelectors: this.eventSelectors,
        });
        this.trailArn = this.getResourceArnAttribute(trail.attrArn, {
            service: 'cloudtrail',
            resource: 'trail',
            resourceName: this.physicalName,
        });
        this.trailSnsTopicArn = trail.attrSnsTopicArn;
        // Add a dependency on the bucket policy being updated, CloudTrail will test this upon creation.
        if (this.s3bucket.policy) {
            trail.node.addDependency(this.s3bucket.policy);
        }
        // If props.sendToCloudWatchLogs is set to true then the trail needs to depend on the created logsRole
        // so that it can create the log stream for the log group. This ensures the logsRole is created and propagated
        // before the trail tries to create the log stream.
        if (logsRole !== undefined) {
            trail.node.addDependency(logsRole);
        }
    }
    /**
     * Create an event rule for when an event is recorded by any Trail in the account.
     *
     * Note that the event doesn't necessarily have to come from this Trail, it can
     * be captured from any one.
     *
     * Be sure to filter the event further down using an event pattern.
     */
    static onEvent(scope, id, options = {}) {
        const rule = new events.Rule(scope, id, options);
        rule.addTarget(options.target);
        rule.addEventPattern({
            detailType: ['AWS API Call via CloudTrail'],
        });
        return rule;
    }
    /**
     * When an event occurs in your account, CloudTrail evaluates whether the event matches the settings for your trails.
     * Only events that match your trail settings are delivered to your Amazon S3 bucket and Amazon CloudWatch Logs log group.
     *
     * This method adds an Event Selector for filtering events that match either S3 or Lambda function operations.
     *
     * Data events: These events provide insight into the resource operations performed on or within a resource.
     * These are also known as data plane operations.
     *
     * @param dataResourceValues the list of data resource ARNs to include in logging (maximum 250 entries).
     * @param options the options to configure logging of management and data events.
     */
    addEventSelector(dataResourceType, dataResourceValues, options = {}) {
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_cloudtrail_DataResourceType(dataResourceType);
            jsiiDeprecationWarnings._aws_cdk_aws_cloudtrail_AddEventSelectorOptions(options);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.addEventSelector);
            }
            throw error;
        }
        if (dataResourceValues.length > 250) {
            throw new Error('A maximum of 250 data elements can be in one event selector');
        }
        if (this.eventSelectors.length > 5) {
            throw new Error('A maximum of 5 event selectors are supported per trail.');
        }
        this.eventSelectors.push({
            dataResources: [{
                    type: dataResourceType,
                    values: dataResourceValues,
                }],
            includeManagementEvents: options.includeManagementEvents,
            excludeManagementEventSources: options.excludeManagementEventSources,
            readWriteType: options.readWriteType,
        });
    }
    /**
     * When an event occurs in your account, CloudTrail evaluates whether the event matches the settings for your trails.
     * Only events that match your trail settings are delivered to your Amazon S3 bucket and Amazon CloudWatch Logs log group.
     *
     * This method adds a Lambda Data Event Selector for filtering events that match Lambda function operations.
     *
     * Data events: These events provide insight into the resource operations performed on or within a resource.
     * These are also known as data plane operations.
     *
     * @param handlers the list of lambda function handlers whose data events should be logged (maximum 250 entries).
     * @param options the options to configure logging of management and data events.
     */
    addLambdaEventSelector(handlers, options = {}) {
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_cloudtrail_AddEventSelectorOptions(options);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.addLambdaEventSelector);
            }
            throw error;
        }
        if (handlers.length === 0) {
            return;
        }
        const dataResourceValues = handlers.map((h) => h.functionArn);
        return this.addEventSelector(DataResourceType.LAMBDA_FUNCTION, dataResourceValues, options);
    }
    /**
     * Log all Lamda data events for all lambda functions the account.
     * @see https://docs.aws.amazon.com/awscloudtrail/latest/userguide/logging-data-events-with-cloudtrail.html
     * @default false
     */
    logAllLambdaDataEvents(options = {}) {
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_cloudtrail_AddEventSelectorOptions(options);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.logAllLambdaDataEvents);
            }
            throw error;
        }
        return this.addEventSelector(DataResourceType.LAMBDA_FUNCTION, [`arn:${this.stack.partition}:lambda`], options);
    }
    /**
     * When an event occurs in your account, CloudTrail evaluates whether the event matches the settings for your trails.
     * Only events that match your trail settings are delivered to your Amazon S3 bucket and Amazon CloudWatch Logs log group.
     *
     * This method adds an S3 Data Event Selector for filtering events that match S3 operations.
     *
     * Data events: These events provide insight into the resource operations performed on or within a resource.
     * These are also known as data plane operations.
     *
     * @param s3Selector the list of S3 bucket with optional prefix to include in logging (maximum 250 entries).
     * @param options the options to configure logging of management and data events.
     */
    addS3EventSelector(s3Selector, options = {}) {
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_cloudtrail_AddEventSelectorOptions(options);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.addS3EventSelector);
            }
            throw error;
        }
        if (s3Selector.length === 0) {
            return;
        }
        const dataResourceValues = s3Selector.map((sel) => `${sel.bucket.bucketArn}/${sel.objectPrefix ?? ''}`);
        return this.addEventSelector(DataResourceType.S3_OBJECT, dataResourceValues, options);
    }
    /**
     * Log all S3 data events for all objects for all buckets in the account.
     * @see https://docs.aws.amazon.com/awscloudtrail/latest/userguide/logging-data-events-with-cloudtrail.html
     * @default false
     */
    logAllS3DataEvents(options = {}) {
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_cloudtrail_AddEventSelectorOptions(options);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.logAllS3DataEvents);
            }
            throw error;
        }
        return this.addEventSelector(DataResourceType.S3_OBJECT, [`arn:${this.stack.partition}:s3:::`], options);
    }
    /**
     * Create an event rule for when an event is recorded by any Trail in the account.
     *
     * Note that the event doesn't necessarily have to come from this Trail, it can
     * be captured from any one.
     *
     * Be sure to filter the event further down using an event pattern.
     *
     * @deprecated - use Trail.onEvent()
     */
    onCloudTrailEvent(id, options = {}) {
        try {
            jsiiDeprecationWarnings.print("@aws-cdk/aws-cloudtrail.Trail#onCloudTrailEvent", "- use Trail.onEvent()");
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.onCloudTrailEvent);
            }
            throw error;
        }
        return Trail.onEvent(this, id, options);
    }
}
exports.Trail = Trail;
_a = JSII_RTTI_SYMBOL_1;
Trail[_a] = { fqn: "@aws-cdk/aws-cloudtrail.Trail", version: "1.169.0" };
/**
 * Types of management event sources that can be excluded
 */
var ManagementEventSources;
(function (ManagementEventSources) {
    /**
     * AWS Key Management Service (AWS KMS) events
     */
    ManagementEventSources["KMS"] = "kms.amazonaws.com";
    /**
     * Data API events
     */
    ManagementEventSources["RDS_DATA_API"] = "rdsdata.amazonaws.com";
})(ManagementEventSources = exports.ManagementEventSources || (exports.ManagementEventSources = {}));
/**
 * Resource type for a data event
 */
var DataResourceType;
(function (DataResourceType) {
    /**
     * Data resource type for Lambda function
     */
    DataResourceType["LAMBDA_FUNCTION"] = "AWS::Lambda::Function";
    /**
     * Data resource type for S3 objects
     */
    DataResourceType["S3_OBJECT"] = "AWS::S3::Object";
})(DataResourceType = exports.DataResourceType || (exports.DataResourceType = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xvdWR0cmFpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNsb3VkdHJhaWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsOENBQThDO0FBQzlDLHdDQUF3QztBQUd4QywwQ0FBMEM7QUFDMUMsc0NBQXNDO0FBRXRDLHdDQUFnRDtBQUVoRCxpRUFBa0Q7QUE4R2xEOztHQUVHO0FBQ0gsSUFBWSxhQXdCWDtBQXhCRCxXQUFZLGFBQWE7SUFDdkI7Ozs7O09BS0c7SUFDSCx1Q0FBc0IsQ0FBQTtJQUN0Qjs7Ozs7T0FLRztJQUNILHlDQUF3QixDQUFBO0lBQ3hCOztPQUVHO0lBQ0gsNEJBQVcsQ0FBQTtJQUVYOztPQUVHO0lBQ0gsOEJBQWEsQ0FBQTtBQUNmLENBQUMsRUF4QlcsYUFBYSxHQUFiLHFCQUFhLEtBQWIscUJBQWEsUUF3QnhCO0FBRUQ7Ozs7Ozs7Ozs7OztHQVlHO0FBQ0gsTUFBYSxLQUFNLFNBQVEsZUFBUTtJQTJDakMsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxRQUFvQixFQUFFO1FBQzlELEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFO1lBQ2YsWUFBWSxFQUFFLEtBQUssQ0FBQyxTQUFTO1NBQzlCLENBQUMsQ0FBQztRQU5HLG1CQUFjLEdBQW9CLEVBQUUsQ0FBQzs7Ozs7OytDQXhDbEMsS0FBSzs7OztRQWdEZCxNQUFNLG1CQUFtQixHQUFHLElBQUksR0FBRyxDQUFDLGdCQUFnQixDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFFakYsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUMsTUFBTSxJQUFJLElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUUsVUFBVSxFQUFFLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7UUFFN0gsSUFBSSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLEdB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RSxPQUFPLENBQUMsQ0FBQztLQUN2RjtJQUVEOzs7O09BSUc7SUFDSSxrQkFBa0IsQ0FBQyxVQUFtQyxFQUFFOzs7Ozs7Ozs7O1FBQzdELE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxDQUFDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLFFBQVEsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0tBQzFHO0lBRUQ7Ozs7Ozs7OztPQVNHO0lBQ0ksaUJBQWlCLENBQUMsRUFBVSxFQUFFLFVBQWlDLEVBQUU7Ozs7Ozs7Ozs7UUFDdEUsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsT0FBTyxDQUFDLENBQUM7S0FDekM7O0FBdFBILHNCQXVQQzs7O0FBNEJEOztHQUVHO0FBQ0gsSUFBWSxzQkFVWDtBQVZELFdBQVksc0JBQXNCO0lBQ2hDOztPQUVHO0lBQ0gsbURBQXlCLENBQUE7SUFFekI7O09BRUc7SUFDSCxnRUFBc0MsQ0FBQTtBQUN4QyxDQUFDLEVBVlcsc0JBQXNCLEdBQXRCLDhCQUFzQixLQUF0Qiw4QkFBc0IsUUFVakM7QUFnQkQ7O0dBRUc7QUFDSCxJQUFZLGdCQVVYO0FBVkQsV0FBWSxnQkFBZ0I7SUFDMUI7O09BRUc7SUFDSCw2REFBeUMsQ0FBQTtJQUV6Qzs7T0FFRztJQUNILGlEQUE2QixDQUFBO0FBQy9CLENBQUMsRUFWVyxnQkFBZ0IsR0FBaEIsd0JBQWdCLEtBQWhCLHdCQUFnQixRQVUzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGV2ZW50cyBmcm9tICdAYXdzLWNkay9hd3MtZXZlbnRzJztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICdAYXdzLWNkay9hd3MtaWFtJztcbmltcG9ydCAqIGFzIGttcyBmcm9tICdAYXdzLWNkay9hd3Mta21zJztcbmltcG9ydCAqIGFzIGxhbWJkYSBmcm9tICdAYXdzLWNkay9hd3MtbGFtYmRhJztcbmltcG9ydCAqIGFzIGxvZ3MgZnJvbSAnQGF3cy1jZGsvYXdzLWxvZ3MnO1xuaW1wb3J0ICogYXMgczMgZnJvbSAnQGF3cy1jZGsvYXdzLXMzJztcbmltcG9ydCAqIGFzIHNucyBmcm9tICdAYXdzLWNkay9hd3Mtc25zJztcbmltcG9ydCB7IFJlc291cmNlLCBTdGFjayB9IGZyb20gJ0Bhd3MtY2RrL2NvcmUnO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQgeyBDZm5UcmFpbCB9IGZyb20gJy4vY2xvdWR0cmFpbC5nZW5lcmF0ZWQnO1xuXG4vKipcbiAqIFByb3BlcnRpZXMgZm9yIGFuIEFXUyBDbG91ZFRyYWlsIHRyYWlsXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVHJhaWxQcm9wcyB7XG4gIC8qKlxuICAgKiBGb3IgbW9zdCBzZXJ2aWNlcywgZXZlbnRzIGFyZSByZWNvcmRlZCBpbiB0aGUgcmVnaW9uIHdoZXJlIHRoZSBhY3Rpb24gb2NjdXJyZWQuXG4gICAqIEZvciBnbG9iYWwgc2VydmljZXMgc3VjaCBhcyBBV1MgSWRlbnRpdHkgYW5kIEFjY2VzcyBNYW5hZ2VtZW50IChJQU0pLCBBV1MgU1RTLCBBbWF6b24gQ2xvdWRGcm9udCwgYW5kIFJvdXRlIDUzLFxuICAgKiBldmVudHMgYXJlIGRlbGl2ZXJlZCB0byBhbnkgdHJhaWwgdGhhdCBpbmNsdWRlcyBnbG9iYWwgc2VydmljZXMsIGFuZCBhcmUgbG9nZ2VkIGFzIG9jY3VycmluZyBpbiBVUyBFYXN0IChOLiBWaXJnaW5pYSkgUmVnaW9uLlxuICAgKlxuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqL1xuICByZWFkb25seSBpbmNsdWRlR2xvYmFsU2VydmljZUV2ZW50cz86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgb3Igbm90IHRoaXMgdHJhaWwgZGVsaXZlcnMgbG9nIGZpbGVzIGZyb20gbXVsdGlwbGUgcmVnaW9ucyB0byBhIHNpbmdsZSBTMyBidWNrZXQgZm9yIGEgc2luZ2xlIGFjY291bnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICovXG4gIHJlYWRvbmx5IGlzTXVsdGlSZWdpb25UcmFpbD86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFdoZW4gYW4gZXZlbnQgb2NjdXJzIGluIHlvdXIgYWNjb3VudCwgQ2xvdWRUcmFpbCBldmFsdWF0ZXMgd2hldGhlciB0aGUgZXZlbnQgbWF0Y2hlcyB0aGUgc2V0dGluZ3MgZm9yIHlvdXIgdHJhaWxzLlxuICAgKiBPbmx5IGV2ZW50cyB0aGF0IG1hdGNoIHlvdXIgdHJhaWwgc2V0dGluZ3MgYXJlIGRlbGl2ZXJlZCB0byB5b3VyIEFtYXpvbiBTMyBidWNrZXQgYW5kIEFtYXpvbiBDbG91ZFdhdGNoIExvZ3MgbG9nIGdyb3VwLlxuICAgKlxuICAgKiBUaGlzIG1ldGhvZCBzZXRzIHRoZSBtYW5hZ2VtZW50IGNvbmZpZ3VyYXRpb24gZm9yIHRoaXMgdHJhaWwuXG4gICAqXG4gICAqIE1hbmFnZW1lbnQgZXZlbnRzIHByb3ZpZGUgaW5zaWdodCBpbnRvIG1hbmFnZW1lbnQgb3BlcmF0aW9ucyB0aGF0IGFyZSBwZXJmb3JtZWQgb24gcmVzb3VyY2VzIGluIHlvdXIgQVdTIGFjY291bnQuXG4gICAqIFRoZXNlIGFyZSBhbHNvIGtub3duIGFzIGNvbnRyb2wgcGxhbmUgb3BlcmF0aW9ucy5cbiAgICogTWFuYWdlbWVudCBldmVudHMgY2FuIGFsc28gaW5jbHVkZSBub24tQVBJIGV2ZW50cyB0aGF0IG9jY3VyIGluIHlvdXIgYWNjb3VudC5cbiAgICogRm9yIGV4YW1wbGUsIHdoZW4gYSB1c2VyIGxvZ3MgaW4gdG8geW91ciBhY2NvdW50LCBDbG91ZFRyYWlsIGxvZ3MgdGhlIENvbnNvbGVMb2dpbiBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIG1hbmFnZW1lbnRFdmVudHMgdGhlIG1hbmFnZW1lbnQgY29uZmlndXJhdGlvbiB0eXBlIHRvIGxvZ1xuICAgKlxuICAgKiBAZGVmYXVsdCBSZWFkV3JpdGVUeXBlLkFMTFxuICAgKi9cbiAgcmVhZG9ubHkgbWFuYWdlbWVudEV2ZW50cz86IFJlYWRXcml0ZVR5cGU7XG5cbiAgLyoqXG4gICAqIFRvIGRldGVybWluZSB3aGV0aGVyIGEgbG9nIGZpbGUgd2FzIG1vZGlmaWVkLCBkZWxldGVkLCBvciB1bmNoYW5nZWQgYWZ0ZXIgQ2xvdWRUcmFpbCBkZWxpdmVyZWQgaXQsXG4gICAqIHlvdSBjYW4gdXNlIENsb3VkVHJhaWwgbG9nIGZpbGUgaW50ZWdyaXR5IHZhbGlkYXRpb24uXG4gICAqIFRoaXMgZmVhdHVyZSBpcyBidWlsdCB1c2luZyBpbmR1c3RyeSBzdGFuZGFyZCBhbGdvcml0aG1zOiBTSEEtMjU2IGZvciBoYXNoaW5nIGFuZCBTSEEtMjU2IHdpdGggUlNBIGZvciBkaWdpdGFsIHNpZ25pbmcuXG4gICAqIFRoaXMgbWFrZXMgaXQgY29tcHV0YXRpb25hbGx5IGluZmVhc2libGUgdG8gbW9kaWZ5LCBkZWxldGUgb3IgZm9yZ2UgQ2xvdWRUcmFpbCBsb2cgZmlsZXMgd2l0aG91dCBkZXRlY3Rpb24uXG4gICAqIFlvdSBjYW4gdXNlIHRoZSBBV1MgQ0xJIHRvIHZhbGlkYXRlIHRoZSBmaWxlcyBpbiB0aGUgbG9jYXRpb24gd2hlcmUgQ2xvdWRUcmFpbCBkZWxpdmVyZWQgdGhlbS5cbiAgICpcbiAgICogQGRlZmF1bHQgdHJ1ZVxuICAgKi9cbiAgcmVhZG9ubHkgZW5hYmxlRmlsZVZhbGlkYXRpb24/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBJZiBDbG91ZFRyYWlsIHB1c2hlcyBsb2dzIHRvIENsb3VkV2F0Y2ggTG9ncyBpbiBhZGRpdGlvbiB0byBTMy5cbiAgICogRGlzYWJsZWQgZm9yIGNvc3Qgb3V0IG9mIHRoZSBib3guXG4gICAqXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICByZWFkb25seSBzZW5kVG9DbG91ZFdhdGNoTG9ncz86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEhvdyBsb25nIHRvIHJldGFpbiBsb2dzIGluIENsb3VkV2F0Y2hMb2dzLlxuICAgKiBJZ25vcmVkIGlmIHNlbmRUb0Nsb3VkV2F0Y2hMb2dzIGlzIGZhbHNlIG9yIGlmIGNsb3VkV2F0Y2hMb2dHcm91cCBpcyBzZXQuXG4gICAqXG4gICAqICBAZGVmYXVsdCBsb2dzLlJldGVudGlvbkRheXMuT05FX1lFQVJcbiAgICovXG4gIHJlYWRvbmx5IGNsb3VkV2F0Y2hMb2dzUmV0ZW50aW9uPzogbG9ncy5SZXRlbnRpb25EYXlzO1xuXG4gIC8qKlxuICAgKiBMb2cgR3JvdXAgdG8gd2hpY2ggQ2xvdWRUcmFpbCB0byBwdXNoIGxvZ3MgdG8uIElnbm9yZWQgaWYgc2VuZFRvQ2xvdWRXYXRjaExvZ3MgaXMgc2V0IHRvIGZhbHNlLlxuICAgKiBAZGVmYXVsdCAtIGEgbmV3IGxvZyBncm91cCBpcyBjcmVhdGVkIGFuZCB1c2VkLlxuICAgKi9cbiAgcmVhZG9ubHkgY2xvdWRXYXRjaExvZ0dyb3VwPzogbG9ncy5JTG9nR3JvdXA7XG5cbiAgLyoqIFRoZSBBV1MgS2V5IE1hbmFnZW1lbnQgU2VydmljZSAoQVdTIEtNUykga2V5IElEIHRoYXQgeW91IHdhbnQgdG8gdXNlIHRvIGVuY3J5cHQgQ2xvdWRUcmFpbCBsb2dzLlxuICAgKiBAZGVmYXVsdCAtIE5vIGVuY3J5cHRpb24uXG4gICAqIEBkZXByZWNhdGVkIC0gdXNlIGVuY3J5cHRpb25LZXkgaW5zdGVhZC5cbiAgICovXG4gIHJlYWRvbmx5IGttc0tleT86IGttcy5JS2V5O1xuXG4gIC8qKiBUaGUgQVdTIEtleSBNYW5hZ2VtZW50IFNlcnZpY2UgKEFXUyBLTVMpIGtleSBJRCB0aGF0IHlvdSB3YW50IHRvIHVzZSB0byBlbmNyeXB0IENsb3VkVHJhaWwgbG9ncy5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBlbmNyeXB0aW9uLlxuICAgKi9cbiAgcmVhZG9ubHkgZW5jcnlwdGlvbktleT86IGttcy5JS2V5O1xuXG4gIC8qKiBTTlMgdG9waWMgdGhhdCBpcyBub3RpZmllZCB3aGVuIG5ldyBsb2cgZmlsZXMgYXJlIHB1Ymxpc2hlZC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBub3RpZmljYXRpb25zLlxuICAgKi9cbiAgcmVhZG9ubHkgc25zVG9waWM/OiBzbnMuSVRvcGljO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgdHJhaWwuIFdlIHJlY29tbWVuZCBjdXN0b21lcnMgZG8gbm90IHNldCBhbiBleHBsaWNpdCBuYW1lLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIEFXUyBDbG91ZEZvcm1hdGlvbiBnZW5lcmF0ZWQgbmFtZS5cbiAgICovXG4gIHJlYWRvbmx5IHRyYWlsTmFtZT86IHN0cmluZztcblxuICAvKiogQW4gQW1hem9uIFMzIG9iamVjdCBrZXkgcHJlZml4IHRoYXQgcHJlY2VkZXMgdGhlIG5hbWUgb2YgYWxsIGxvZyBmaWxlcy5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBwcmVmaXguXG4gICAqL1xuICByZWFkb25seSBzM0tleVByZWZpeD86IHN0cmluZztcblxuICAvKiogVGhlIEFtYXpvbiBTMyBidWNrZXRcbiAgICpcbiAgICogQGRlZmF1bHQgLSBpZiBub3Qgc3VwcGxpZWQgYSBidWNrZXQgd2lsbCBiZSBjcmVhdGVkIHdpdGggYWxsIHRoZSBjb3JyZWN0IHBlcm1pc2lvbnNcbiAgICovXG4gIHJlYWRvbmx5IGJ1Y2tldD86IHMzLklCdWNrZXQ7XG59XG5cbi8qKlxuICogVHlwZXMgb2YgZXZlbnRzIHRoYXQgQ2xvdWRUcmFpbCBjYW4gbG9nXG4gKi9cbmV4cG9ydCBlbnVtIFJlYWRXcml0ZVR5cGUge1xuICAvKipcbiAgICogUmVhZC1vbmx5IGV2ZW50cyBpbmNsdWRlIEFQSSBvcGVyYXRpb25zIHRoYXQgcmVhZCB5b3VyIHJlc291cmNlcyxcbiAgICogYnV0IGRvbid0IG1ha2UgY2hhbmdlcy5cbiAgICogRm9yIGV4YW1wbGUsIHJlYWQtb25seSBldmVudHMgaW5jbHVkZSB0aGUgQW1hem9uIEVDMiBEZXNjcmliZVNlY3VyaXR5R3JvdXBzXG4gICAqIGFuZCBEZXNjcmliZVN1Ym5ldHMgQVBJIG9wZXJhdGlvbnMuXG4gICAqL1xuICBSRUFEX09OTFkgPSAnUmVhZE9ubHknLFxuICAvKipcbiAgICogV3JpdGUtb25seSBldmVudHMgaW5jbHVkZSBBUEkgb3BlcmF0aW9ucyB0aGF0IG1vZGlmeSAob3IgbWlnaHQgbW9kaWZ5KVxuICAgKiB5b3VyIHJlc291cmNlcy5cbiAgICogRm9yIGV4YW1wbGUsIHRoZSBBbWF6b24gRUMyIFJ1bkluc3RhbmNlcyBhbmQgVGVybWluYXRlSW5zdGFuY2VzIEFQSVxuICAgKiBvcGVyYXRpb25zIG1vZGlmeSB5b3VyIGluc3RhbmNlcy5cbiAgICovXG4gIFdSSVRFX09OTFkgPSAnV3JpdGVPbmx5JyxcbiAgLyoqXG4gICAqIEFsbCBldmVudHNcbiAgICovXG4gIEFMTCA9ICdBbGwnLFxuXG4gIC8qKlxuICAgKiBObyBldmVudHNcbiAgICovXG4gIE5PTkUgPSAnTm9uZScsXG59XG5cbi8qKlxuICogQ2xvdWQgdHJhaWwgYWxsb3dzIHlvdSB0byBsb2cgZXZlbnRzIHRoYXQgaGFwcGVuIGluIHlvdXIgQVdTIGFjY291bnRcbiAqIEZvciBleGFtcGxlOlxuICpcbiAqIGltcG9ydCB7IENsb3VkVHJhaWwgfSBmcm9tICdAYXdzLWNkay9hd3MtY2xvdWR0cmFpbCdcbiAqXG4gKiBjb25zdCBjbG91ZFRyYWlsID0gbmV3IENsb3VkVHJhaWwodGhpcywgJ015VHJhaWwnKTtcbiAqXG4gKiBOT1RFIHRoZSBhYm92ZSBleGFtcGxlIGNyZWF0ZXMgYW4gVU5FTkNSWVBURUQgYnVja2V0IGJ5IGRlZmF1bHQsXG4gKiBJZiB5b3UgYXJlIHJlcXVpcmVkIHRvIHVzZSBhbiBFbmNyeXB0ZWQgYnVja2V0IHlvdSBjYW4gc3VwcGx5IGEgcHJlY29uZmlndXJlZCBidWNrZXRcbiAqIHZpYSBUcmFpbFByb3BzXG4gKlxuICovXG5leHBvcnQgY2xhc3MgVHJhaWwgZXh0ZW5kcyBSZXNvdXJjZSB7XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhbiBldmVudCBydWxlIGZvciB3aGVuIGFuIGV2ZW50IGlzIHJlY29yZGVkIGJ5IGFueSBUcmFpbCBpbiB0aGUgYWNjb3VudC5cbiAgICpcbiAgICogTm90ZSB0aGF0IHRoZSBldmVudCBkb2Vzbid0IG5lY2Vzc2FyaWx5IGhhdmUgdG8gY29tZSBmcm9tIHRoaXMgVHJhaWwsIGl0IGNhblxuICAgKiBiZSBjYXB0dXJlZCBmcm9tIGFueSBvbmUuXG4gICAqXG4gICAqIEJlIHN1cmUgdG8gZmlsdGVyIHRoZSBldmVudCBmdXJ0aGVyIGRvd24gdXNpbmcgYW4gZXZlbnQgcGF0dGVybi5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgb25FdmVudChzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBvcHRpb25zOiBldmVudHMuT25FdmVudE9wdGlvbnMgPSB7fSk6IGV2ZW50cy5SdWxlIHtcbiAgICBjb25zdCBydWxlID0gbmV3IGV2ZW50cy5SdWxlKHNjb3BlLCBpZCwgb3B0aW9ucyk7XG4gICAgcnVsZS5hZGRUYXJnZXQob3B0aW9ucy50YXJnZXQpO1xuICAgIHJ1bGUuYWRkRXZlbnRQYXR0ZXJuKHtcbiAgICAgIGRldGFpbFR5cGU6IFsnQVdTIEFQSSBDYWxsIHZpYSBDbG91ZFRyYWlsJ10sXG4gICAgfSk7XG4gICAgcmV0dXJuIHJ1bGU7XG4gIH1cblxuICAvKipcbiAgICogQVJOIG9mIHRoZSBDbG91ZFRyYWlsIHRyYWlsXG4gICAqIGkuZS4gYXJuOmF3czpjbG91ZHRyYWlsOnVzLWVhc3QtMjoxMjM0NTY3ODkwMTI6dHJhaWwvbXlDbG91ZFRyYWlsXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSB0cmFpbEFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBUk4gb2YgdGhlIEFtYXpvbiBTTlMgdG9waWMgdGhhdCdzIGFzc29jaWF0ZWQgd2l0aCB0aGUgQ2xvdWRUcmFpbCB0cmFpbCxcbiAgICogaS5lLiBhcm46YXdzOnNuczp1cy1lYXN0LTI6MTIzNDU2Nzg5MDEyOm15U05TVG9waWNcbiAgICogQGF0dHJpYnV0ZVxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHRyYWlsU25zVG9waWNBcm46IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIENsb3VkV2F0Y2ggbG9nIGdyb3VwIHRvIHdoaWNoIENsb3VkVHJhaWwgZXZlbnRzIGFyZSBzZW50LlxuICAgKiBgdW5kZWZpbmVkYCBpZiBgc2VuZFRvQ2xvdWRXYXRjaExvZ3NgIHByb3BlcnR5IGlzIGZhbHNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGxvZ0dyb3VwPzogbG9ncy5JTG9nR3JvdXA7XG5cbiAgcHJpdmF0ZSBzM2J1Y2tldDogczMuSUJ1Y2tldDtcbiAgcHJpdmF0ZSBldmVudFNlbGVjdG9yczogRXZlbnRTZWxlY3RvcltdID0gW107XG4gIHByaXZhdGUgdG9waWM6IHNucy5JVG9waWMgfCB1bmRlZmluZWQ7XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IFRyYWlsUHJvcHMgPSB7fSkge1xuICAgIHN1cGVyKHNjb3BlLCBpZCwge1xuICAgICAgcGh5c2ljYWxOYW1lOiBwcm9wcy50cmFpbE5hbWUsXG4gICAgfSk7XG5cbiAgICBjb25zdCBjbG91ZFRyYWlsUHJpbmNpcGFsID0gbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdjbG91ZHRyYWlsLmFtYXpvbmF3cy5jb20nKTtcblxuICAgIHRoaXMuczNidWNrZXQgPSBwcm9wcy5idWNrZXQgfHwgbmV3IHMzLkJ1Y2tldCh0aGlzLCAnUzMnLCB7IGVuY3J5cHRpb246IHMzLkJ1Y2tldEVuY3J5cHRpb24uVU5FTkNSWVBURUQsIGVuZm9yY2VTU0w6IHRydWUgfSk7XG5cbiAgICB0aGlzLnMzYnVja2V0LmFkZFRvUmVzb3VyY2VQb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgcmVzb3VyY2VzOiBbdGhpcy5zM2J1Y2tldC5idWNrZXRBcm5dLFxuICAgICAgYWN0aW9uczogWydzMzpHZXRCdWNrZXRBY2wnXSxcbiAgICAgIHByaW5jaXBhbHM6IFtjbG91ZFRyYWlsUHJpbmNpcGFsXSxcbiAgICB9KSk7XG5cbiAgICB0aGlzLnMzYnVja2V0LmFkZFRvUmVzb3VyY2VQb2xpY3kobmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgcmVzb3VyY2VzOiBbdGhpcy5zM2J1Y2tldC5hcm5Gb3JPYmplY3RzKFxuICAgICAgICBgJHtwcm9wcy5zM0tleVByZWZpeCA/IGAke3Byb3BzLnMzS2V5UHJlZml4fS9gIDogJyd9QVdTTG9ncy8ke1N0YWNrLm9mKHRoaXMpLmFjY291bnR9LypgLFxuICAgICAgKV0sXG4gICAgICBhY3Rpb25zOiBbJ3MzOlB1dE9iamVjdCddLFxuICAgICAgcHJpbmNpcGFsczogW2Nsb3VkVHJhaWxQcmluY2lwYWxdLFxuICAgICAgY29uZGl0aW9uczoge1xuICAgICAgICBTdHJpbmdFcXVhbHM6IHsgJ3MzOngtYW16LWFjbCc6ICdidWNrZXQtb3duZXItZnVsbC1jb250cm9sJyB9LFxuICAgICAgfSxcbiAgICB9KSk7XG5cbiAgICB0aGlzLnRvcGljID0gcHJvcHMuc25zVG9waWM7XG4gICAgaWYgKHRoaXMudG9waWMpIHtcbiAgICAgIHRoaXMudG9waWMuZ3JhbnRQdWJsaXNoKGNsb3VkVHJhaWxQcmluY2lwYWwpO1xuICAgIH1cblxuICAgIGxldCBsb2dzUm9sZTogaWFtLklSb2xlIHwgdW5kZWZpbmVkO1xuXG4gICAgaWYgKHByb3BzLnNlbmRUb0Nsb3VkV2F0Y2hMb2dzKSB7XG4gICAgICBpZiAocHJvcHMuY2xvdWRXYXRjaExvZ0dyb3VwKSB7XG4gICAgICAgIHRoaXMubG9nR3JvdXAgPSBwcm9wcy5jbG91ZFdhdGNoTG9nR3JvdXA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmxvZ0dyb3VwID0gbmV3IGxvZ3MuTG9nR3JvdXAodGhpcywgJ0xvZ0dyb3VwJywge1xuICAgICAgICAgIHJldGVudGlvbjogcHJvcHMuY2xvdWRXYXRjaExvZ3NSZXRlbnRpb24gPz8gbG9ncy5SZXRlbnRpb25EYXlzLk9ORV9ZRUFSLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgbG9nc1JvbGUgPSBuZXcgaWFtLlJvbGUodGhpcywgJ0xvZ3NSb2xlJywgeyBhc3N1bWVkQnk6IGNsb3VkVHJhaWxQcmluY2lwYWwgfSk7XG5cbiAgICAgIGxvZ3NSb2xlLmFkZFRvUHJpbmNpcGFsUG9saWN5KG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgYWN0aW9uczogWydsb2dzOlB1dExvZ0V2ZW50cycsICdsb2dzOkNyZWF0ZUxvZ1N0cmVhbSddLFxuICAgICAgICByZXNvdXJjZXM6IFt0aGlzLmxvZ0dyb3VwLmxvZ0dyb3VwQXJuXSxcbiAgICAgIH0pKTtcbiAgICB9XG5cbiAgICBpZiAocHJvcHMubWFuYWdlbWVudEV2ZW50cykge1xuICAgICAgbGV0IG1hbmFnZW1lbnRFdmVudDtcbiAgICAgIGlmIChwcm9wcy5tYW5hZ2VtZW50RXZlbnRzID09PSBSZWFkV3JpdGVUeXBlLk5PTkUpIHtcbiAgICAgICAgbWFuYWdlbWVudEV2ZW50ID0ge1xuICAgICAgICAgIGluY2x1ZGVNYW5hZ2VtZW50RXZlbnRzOiBmYWxzZSxcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1hbmFnZW1lbnRFdmVudCA9IHtcbiAgICAgICAgICBpbmNsdWRlTWFuYWdlbWVudEV2ZW50czogdHJ1ZSxcbiAgICAgICAgICByZWFkV3JpdGVUeXBlOiBwcm9wcy5tYW5hZ2VtZW50RXZlbnRzLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgdGhpcy5ldmVudFNlbGVjdG9ycy5wdXNoKG1hbmFnZW1lbnRFdmVudCk7XG4gICAgfVxuXG4gICAgaWYgKHByb3BzLmttc0tleSAmJiBwcm9wcy5lbmNyeXB0aW9uS2V5KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JvdGgga21zS2V5IGFuZCBlbmNyeXB0aW9uS2V5IG11c3Qgbm90IGJlIHNwZWNpZmllZC4gVXNlIG9ubHkgZW5jcnlwdGlvbktleScpO1xuICAgIH1cblxuICAgIC8vIFRPRE86IG5vdCBhbGwgcmVnaW9ucyBzdXBwb3J0IHZhbGlkYXRpb24uIFVzZSBzZXJ2aWNlIGNvbmZpZ3VyYXRpb24gZGF0YSB0byBmYWlsIGdyYWNlZnVsbHlcbiAgICBjb25zdCB0cmFpbCA9IG5ldyBDZm5UcmFpbCh0aGlzLCAnUmVzb3VyY2UnLCB7XG4gICAgICBpc0xvZ2dpbmc6IHRydWUsXG4gICAgICBlbmFibGVMb2dGaWxlVmFsaWRhdGlvbjogcHJvcHMuZW5hYmxlRmlsZVZhbGlkYXRpb24gPT0gbnVsbCA/IHRydWUgOiBwcm9wcy5lbmFibGVGaWxlVmFsaWRhdGlvbixcbiAgICAgIGlzTXVsdGlSZWdpb25UcmFpbDogcHJvcHMuaXNNdWx0aVJlZ2lvblRyYWlsID09IG51bGwgPyB0cnVlIDogcHJvcHMuaXNNdWx0aVJlZ2lvblRyYWlsLFxuICAgICAgaW5jbHVkZUdsb2JhbFNlcnZpY2VFdmVudHM6IHByb3BzLmluY2x1ZGVHbG9iYWxTZXJ2aWNlRXZlbnRzID09IG51bGwgPyB0cnVlIDogcHJvcHMuaW5jbHVkZUdsb2JhbFNlcnZpY2VFdmVudHMsXG4gICAgICB0cmFpbE5hbWU6IHRoaXMucGh5c2ljYWxOYW1lLFxuICAgICAga21zS2V5SWQ6IHByb3BzLmVuY3J5cHRpb25LZXk/LmtleUFybiA/PyBwcm9wcy5rbXNLZXk/LmtleUFybixcbiAgICAgIHMzQnVja2V0TmFtZTogdGhpcy5zM2J1Y2tldC5idWNrZXROYW1lLFxuICAgICAgczNLZXlQcmVmaXg6IHByb3BzLnMzS2V5UHJlZml4LFxuICAgICAgY2xvdWRXYXRjaExvZ3NMb2dHcm91cEFybjogdGhpcy5sb2dHcm91cD8ubG9nR3JvdXBBcm4sXG4gICAgICBjbG91ZFdhdGNoTG9nc1JvbGVBcm46IGxvZ3NSb2xlPy5yb2xlQXJuLFxuICAgICAgc25zVG9waWNOYW1lOiB0aGlzLnRvcGljPy50b3BpY05hbWUsXG4gICAgICBldmVudFNlbGVjdG9yczogdGhpcy5ldmVudFNlbGVjdG9ycyxcbiAgICB9KTtcblxuICAgIHRoaXMudHJhaWxBcm4gPSB0aGlzLmdldFJlc291cmNlQXJuQXR0cmlidXRlKHRyYWlsLmF0dHJBcm4sIHtcbiAgICAgIHNlcnZpY2U6ICdjbG91ZHRyYWlsJyxcbiAgICAgIHJlc291cmNlOiAndHJhaWwnLFxuICAgICAgcmVzb3VyY2VOYW1lOiB0aGlzLnBoeXNpY2FsTmFtZSxcbiAgICB9KTtcbiAgICB0aGlzLnRyYWlsU25zVG9waWNBcm4gPSB0cmFpbC5hdHRyU25zVG9waWNBcm47XG5cbiAgICAvLyBBZGQgYSBkZXBlbmRlbmN5IG9uIHRoZSBidWNrZXQgcG9saWN5IGJlaW5nIHVwZGF0ZWQsIENsb3VkVHJhaWwgd2lsbCB0ZXN0IHRoaXMgdXBvbiBjcmVhdGlvbi5cbiAgICBpZiAodGhpcy5zM2J1Y2tldC5wb2xpY3kpIHtcbiAgICAgIHRyYWlsLm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnMzYnVja2V0LnBvbGljeSk7XG4gICAgfVxuXG4gICAgLy8gSWYgcHJvcHMuc2VuZFRvQ2xvdWRXYXRjaExvZ3MgaXMgc2V0IHRvIHRydWUgdGhlbiB0aGUgdHJhaWwgbmVlZHMgdG8gZGVwZW5kIG9uIHRoZSBjcmVhdGVkIGxvZ3NSb2xlXG4gICAgLy8gc28gdGhhdCBpdCBjYW4gY3JlYXRlIHRoZSBsb2cgc3RyZWFtIGZvciB0aGUgbG9nIGdyb3VwLiBUaGlzIGVuc3VyZXMgdGhlIGxvZ3NSb2xlIGlzIGNyZWF0ZWQgYW5kIHByb3BhZ2F0ZWRcbiAgICAvLyBiZWZvcmUgdGhlIHRyYWlsIHRyaWVzIHRvIGNyZWF0ZSB0aGUgbG9nIHN0cmVhbS5cbiAgICBpZiAobG9nc1JvbGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdHJhaWwubm9kZS5hZGREZXBlbmRlbmN5KGxvZ3NSb2xlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogV2hlbiBhbiBldmVudCBvY2N1cnMgaW4geW91ciBhY2NvdW50LCBDbG91ZFRyYWlsIGV2YWx1YXRlcyB3aGV0aGVyIHRoZSBldmVudCBtYXRjaGVzIHRoZSBzZXR0aW5ncyBmb3IgeW91ciB0cmFpbHMuXG4gICAqIE9ubHkgZXZlbnRzIHRoYXQgbWF0Y2ggeW91ciB0cmFpbCBzZXR0aW5ncyBhcmUgZGVsaXZlcmVkIHRvIHlvdXIgQW1hem9uIFMzIGJ1Y2tldCBhbmQgQW1hem9uIENsb3VkV2F0Y2ggTG9ncyBsb2cgZ3JvdXAuXG4gICAqXG4gICAqIFRoaXMgbWV0aG9kIGFkZHMgYW4gRXZlbnQgU2VsZWN0b3IgZm9yIGZpbHRlcmluZyBldmVudHMgdGhhdCBtYXRjaCBlaXRoZXIgUzMgb3IgTGFtYmRhIGZ1bmN0aW9uIG9wZXJhdGlvbnMuXG4gICAqXG4gICAqIERhdGEgZXZlbnRzOiBUaGVzZSBldmVudHMgcHJvdmlkZSBpbnNpZ2h0IGludG8gdGhlIHJlc291cmNlIG9wZXJhdGlvbnMgcGVyZm9ybWVkIG9uIG9yIHdpdGhpbiBhIHJlc291cmNlLlxuICAgKiBUaGVzZSBhcmUgYWxzbyBrbm93biBhcyBkYXRhIHBsYW5lIG9wZXJhdGlvbnMuXG4gICAqXG4gICAqIEBwYXJhbSBkYXRhUmVzb3VyY2VWYWx1ZXMgdGhlIGxpc3Qgb2YgZGF0YSByZXNvdXJjZSBBUk5zIHRvIGluY2x1ZGUgaW4gbG9nZ2luZyAobWF4aW11bSAyNTAgZW50cmllcykuXG4gICAqIEBwYXJhbSBvcHRpb25zIHRoZSBvcHRpb25zIHRvIGNvbmZpZ3VyZSBsb2dnaW5nIG9mIG1hbmFnZW1lbnQgYW5kIGRhdGEgZXZlbnRzLlxuICAgKi9cbiAgcHVibGljIGFkZEV2ZW50U2VsZWN0b3IoZGF0YVJlc291cmNlVHlwZTogRGF0YVJlc291cmNlVHlwZSwgZGF0YVJlc291cmNlVmFsdWVzOiBzdHJpbmdbXSwgb3B0aW9uczogQWRkRXZlbnRTZWxlY3Rvck9wdGlvbnMgPSB7fSkge1xuICAgIGlmIChkYXRhUmVzb3VyY2VWYWx1ZXMubGVuZ3RoID4gMjUwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0EgbWF4aW11bSBvZiAyNTAgZGF0YSBlbGVtZW50cyBjYW4gYmUgaW4gb25lIGV2ZW50IHNlbGVjdG9yJyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZXZlbnRTZWxlY3RvcnMubGVuZ3RoID4gNSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBIG1heGltdW0gb2YgNSBldmVudCBzZWxlY3RvcnMgYXJlIHN1cHBvcnRlZCBwZXIgdHJhaWwuJyk7XG4gICAgfVxuXG4gICAgdGhpcy5ldmVudFNlbGVjdG9ycy5wdXNoKHtcbiAgICAgIGRhdGFSZXNvdXJjZXM6IFt7XG4gICAgICAgIHR5cGU6IGRhdGFSZXNvdXJjZVR5cGUsXG4gICAgICAgIHZhbHVlczogZGF0YVJlc291cmNlVmFsdWVzLFxuICAgICAgfV0sXG4gICAgICBpbmNsdWRlTWFuYWdlbWVudEV2ZW50czogb3B0aW9ucy5pbmNsdWRlTWFuYWdlbWVudEV2ZW50cyxcbiAgICAgIGV4Y2x1ZGVNYW5hZ2VtZW50RXZlbnRTb3VyY2VzOiBvcHRpb25zLmV4Y2x1ZGVNYW5hZ2VtZW50RXZlbnRTb3VyY2VzLFxuICAgICAgcmVhZFdyaXRlVHlwZTogb3B0aW9ucy5yZWFkV3JpdGVUeXBlLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZW4gYW4gZXZlbnQgb2NjdXJzIGluIHlvdXIgYWNjb3VudCwgQ2xvdWRUcmFpbCBldmFsdWF0ZXMgd2hldGhlciB0aGUgZXZlbnQgbWF0Y2hlcyB0aGUgc2V0dGluZ3MgZm9yIHlvdXIgdHJhaWxzLlxuICAgKiBPbmx5IGV2ZW50cyB0aGF0IG1hdGNoIHlvdXIgdHJhaWwgc2V0dGluZ3MgYXJlIGRlbGl2ZXJlZCB0byB5b3VyIEFtYXpvbiBTMyBidWNrZXQgYW5kIEFtYXpvbiBDbG91ZFdhdGNoIExvZ3MgbG9nIGdyb3VwLlxuICAgKlxuICAgKiBUaGlzIG1ldGhvZCBhZGRzIGEgTGFtYmRhIERhdGEgRXZlbnQgU2VsZWN0b3IgZm9yIGZpbHRlcmluZyBldmVudHMgdGhhdCBtYXRjaCBMYW1iZGEgZnVuY3Rpb24gb3BlcmF0aW9ucy5cbiAgICpcbiAgICogRGF0YSBldmVudHM6IFRoZXNlIGV2ZW50cyBwcm92aWRlIGluc2lnaHQgaW50byB0aGUgcmVzb3VyY2Ugb3BlcmF0aW9ucyBwZXJmb3JtZWQgb24gb3Igd2l0aGluIGEgcmVzb3VyY2UuXG4gICAqIFRoZXNlIGFyZSBhbHNvIGtub3duIGFzIGRhdGEgcGxhbmUgb3BlcmF0aW9ucy5cbiAgICpcbiAgICogQHBhcmFtIGhhbmRsZXJzIHRoZSBsaXN0IG9mIGxhbWJkYSBmdW5jdGlvbiBoYW5kbGVycyB3aG9zZSBkYXRhIGV2ZW50cyBzaG91bGQgYmUgbG9nZ2VkIChtYXhpbXVtIDI1MCBlbnRyaWVzKS5cbiAgICogQHBhcmFtIG9wdGlvbnMgdGhlIG9wdGlvbnMgdG8gY29uZmlndXJlIGxvZ2dpbmcgb2YgbWFuYWdlbWVudCBhbmQgZGF0YSBldmVudHMuXG4gICAqL1xuICBwdWJsaWMgYWRkTGFtYmRhRXZlbnRTZWxlY3RvcihoYW5kbGVyczogbGFtYmRhLklGdW5jdGlvbltdLCBvcHRpb25zOiBBZGRFdmVudFNlbGVjdG9yT3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKGhhbmRsZXJzLmxlbmd0aCA9PT0gMCkgeyByZXR1cm47IH1cbiAgICBjb25zdCBkYXRhUmVzb3VyY2VWYWx1ZXMgPSBoYW5kbGVycy5tYXAoKGgpID0+IGguZnVuY3Rpb25Bcm4pO1xuICAgIHJldHVybiB0aGlzLmFkZEV2ZW50U2VsZWN0b3IoRGF0YVJlc291cmNlVHlwZS5MQU1CREFfRlVOQ1RJT04sIGRhdGFSZXNvdXJjZVZhbHVlcywgb3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICogTG9nIGFsbCBMYW1kYSBkYXRhIGV2ZW50cyBmb3IgYWxsIGxhbWJkYSBmdW5jdGlvbnMgdGhlIGFjY291bnQuXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2F3c2Nsb3VkdHJhaWwvbGF0ZXN0L3VzZXJndWlkZS9sb2dnaW5nLWRhdGEtZXZlbnRzLXdpdGgtY2xvdWR0cmFpbC5odG1sXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICBwdWJsaWMgbG9nQWxsTGFtYmRhRGF0YUV2ZW50cyhvcHRpb25zOiBBZGRFdmVudFNlbGVjdG9yT3B0aW9ucyA9IHt9KSB7XG4gICAgcmV0dXJuIHRoaXMuYWRkRXZlbnRTZWxlY3RvcihEYXRhUmVzb3VyY2VUeXBlLkxBTUJEQV9GVU5DVElPTiwgW2Bhcm46JHt0aGlzLnN0YWNrLnBhcnRpdGlvbn06bGFtYmRhYF0sIG9wdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZW4gYW4gZXZlbnQgb2NjdXJzIGluIHlvdXIgYWNjb3VudCwgQ2xvdWRUcmFpbCBldmFsdWF0ZXMgd2hldGhlciB0aGUgZXZlbnQgbWF0Y2hlcyB0aGUgc2V0dGluZ3MgZm9yIHlvdXIgdHJhaWxzLlxuICAgKiBPbmx5IGV2ZW50cyB0aGF0IG1hdGNoIHlvdXIgdHJhaWwgc2V0dGluZ3MgYXJlIGRlbGl2ZXJlZCB0byB5b3VyIEFtYXpvbiBTMyBidWNrZXQgYW5kIEFtYXpvbiBDbG91ZFdhdGNoIExvZ3MgbG9nIGdyb3VwLlxuICAgKlxuICAgKiBUaGlzIG1ldGhvZCBhZGRzIGFuIFMzIERhdGEgRXZlbnQgU2VsZWN0b3IgZm9yIGZpbHRlcmluZyBldmVudHMgdGhhdCBtYXRjaCBTMyBvcGVyYXRpb25zLlxuICAgKlxuICAgKiBEYXRhIGV2ZW50czogVGhlc2UgZXZlbnRzIHByb3ZpZGUgaW5zaWdodCBpbnRvIHRoZSByZXNvdXJjZSBvcGVyYXRpb25zIHBlcmZvcm1lZCBvbiBvciB3aXRoaW4gYSByZXNvdXJjZS5cbiAgICogVGhlc2UgYXJlIGFsc28ga25vd24gYXMgZGF0YSBwbGFuZSBvcGVyYXRpb25zLlxuICAgKlxuICAgKiBAcGFyYW0gczNTZWxlY3RvciB0aGUgbGlzdCBvZiBTMyBidWNrZXQgd2l0aCBvcHRpb25hbCBwcmVmaXggdG8gaW5jbHVkZSBpbiBsb2dnaW5nIChtYXhpbXVtIDI1MCBlbnRyaWVzKS5cbiAgICogQHBhcmFtIG9wdGlvbnMgdGhlIG9wdGlvbnMgdG8gY29uZmlndXJlIGxvZ2dpbmcgb2YgbWFuYWdlbWVudCBhbmQgZGF0YSBldmVudHMuXG4gICAqL1xuICBwdWJsaWMgYWRkUzNFdmVudFNlbGVjdG9yKHMzU2VsZWN0b3I6IFMzRXZlbnRTZWxlY3RvcltdLCBvcHRpb25zOiBBZGRFdmVudFNlbGVjdG9yT3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKHMzU2VsZWN0b3IubGVuZ3RoID09PSAwKSB7IHJldHVybjsgfVxuICAgIGNvbnN0IGRhdGFSZXNvdXJjZVZhbHVlcyA9IHMzU2VsZWN0b3IubWFwKChzZWwpID0+IGAke3NlbC5idWNrZXQuYnVja2V0QXJufS8ke3NlbC5vYmplY3RQcmVmaXggPz8gJyd9YCk7XG4gICAgcmV0dXJuIHRoaXMuYWRkRXZlbnRTZWxlY3RvcihEYXRhUmVzb3VyY2VUeXBlLlMzX09CSkVDVCwgZGF0YVJlc291cmNlVmFsdWVzLCBvcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgYWxsIFMzIGRhdGEgZXZlbnRzIGZvciBhbGwgb2JqZWN0cyBmb3IgYWxsIGJ1Y2tldHMgaW4gdGhlIGFjY291bnQuXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2F3c2Nsb3VkdHJhaWwvbGF0ZXN0L3VzZXJndWlkZS9sb2dnaW5nLWRhdGEtZXZlbnRzLXdpdGgtY2xvdWR0cmFpbC5odG1sXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqL1xuICBwdWJsaWMgbG9nQWxsUzNEYXRhRXZlbnRzKG9wdGlvbnM6IEFkZEV2ZW50U2VsZWN0b3JPcHRpb25zID0ge30pIHtcbiAgICByZXR1cm4gdGhpcy5hZGRFdmVudFNlbGVjdG9yKERhdGFSZXNvdXJjZVR5cGUuUzNfT0JKRUNULCBbYGFybjoke3RoaXMuc3RhY2sucGFydGl0aW9ufTpzMzo6OmBdLCBvcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYW4gZXZlbnQgcnVsZSBmb3Igd2hlbiBhbiBldmVudCBpcyByZWNvcmRlZCBieSBhbnkgVHJhaWwgaW4gdGhlIGFjY291bnQuXG4gICAqXG4gICAqIE5vdGUgdGhhdCB0aGUgZXZlbnQgZG9lc24ndCBuZWNlc3NhcmlseSBoYXZlIHRvIGNvbWUgZnJvbSB0aGlzIFRyYWlsLCBpdCBjYW5cbiAgICogYmUgY2FwdHVyZWQgZnJvbSBhbnkgb25lLlxuICAgKlxuICAgKiBCZSBzdXJlIHRvIGZpbHRlciB0aGUgZXZlbnQgZnVydGhlciBkb3duIHVzaW5nIGFuIGV2ZW50IHBhdHRlcm4uXG4gICAqXG4gICAqIEBkZXByZWNhdGVkIC0gdXNlIFRyYWlsLm9uRXZlbnQoKVxuICAgKi9cbiAgcHVibGljIG9uQ2xvdWRUcmFpbEV2ZW50KGlkOiBzdHJpbmcsIG9wdGlvbnM6IGV2ZW50cy5PbkV2ZW50T3B0aW9ucyA9IHt9KTogZXZlbnRzLlJ1bGUge1xuICAgIHJldHVybiBUcmFpbC5vbkV2ZW50KHRoaXMsIGlkLCBvcHRpb25zKTtcbiAgfVxufVxuXG4vKipcbiAqIE9wdGlvbnMgZm9yIGFkZGluZyBhbiBldmVudCBzZWxlY3Rvci5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBZGRFdmVudFNlbGVjdG9yT3B0aW9ucyB7XG4gIC8qKlxuICAgKiBTcGVjaWZpZXMgd2hldGhlciB0byBsb2cgcmVhZC1vbmx5IGV2ZW50cywgd3JpdGUtb25seSBldmVudHMsIG9yIGFsbCBldmVudHMuXG4gICAqXG4gICAqIEBkZWZhdWx0IFJlYWRXcml0ZVR5cGUuQWxsXG4gICAqL1xuICByZWFkb25seSByZWFkV3JpdGVUeXBlPzogUmVhZFdyaXRlVHlwZTtcblxuICAvKipcbiAgICogU3BlY2lmaWVzIHdoZXRoZXIgdGhlIGV2ZW50IHNlbGVjdG9yIGluY2x1ZGVzIG1hbmFnZW1lbnQgZXZlbnRzIGZvciB0aGUgdHJhaWwuXG4gICAqXG4gICAqIEBkZWZhdWx0IHRydWVcbiAgICovXG4gIHJlYWRvbmx5IGluY2x1ZGVNYW5hZ2VtZW50RXZlbnRzPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogQW4gb3B0aW9uYWwgbGlzdCBvZiBzZXJ2aWNlIGV2ZW50IHNvdXJjZXMgZnJvbSB3aGljaCB5b3UgZG8gbm90IHdhbnQgbWFuYWdlbWVudCBldmVudHMgdG8gYmUgbG9nZ2VkIG9uIHlvdXIgdHJhaWwuXG4gICAqXG4gICAqIEBkZWZhdWx0IFtdXG4gICAqL1xuICByZWFkb25seSBleGNsdWRlTWFuYWdlbWVudEV2ZW50U291cmNlcz86IE1hbmFnZW1lbnRFdmVudFNvdXJjZXNbXTtcbn1cblxuLyoqXG4gKiBUeXBlcyBvZiBtYW5hZ2VtZW50IGV2ZW50IHNvdXJjZXMgdGhhdCBjYW4gYmUgZXhjbHVkZWRcbiAqL1xuZXhwb3J0IGVudW0gTWFuYWdlbWVudEV2ZW50U291cmNlcyB7XG4gIC8qKlxuICAgKiBBV1MgS2V5IE1hbmFnZW1lbnQgU2VydmljZSAoQVdTIEtNUykgZXZlbnRzXG4gICAqL1xuICBLTVMgPSAna21zLmFtYXpvbmF3cy5jb20nLFxuXG4gIC8qKlxuICAgKiBEYXRhIEFQSSBldmVudHNcbiAgICovXG4gIFJEU19EQVRBX0FQSSA9ICdyZHNkYXRhLmFtYXpvbmF3cy5jb20nLFxufVxuXG4vKipcbiAqIFNlbGVjdGluZyBhbiBTMyBidWNrZXQgYW5kIGFuIG9wdGlvbmFsIHByZWZpeCB0byBiZSBsb2dnZWQgZm9yIGRhdGEgZXZlbnRzLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFMzRXZlbnRTZWxlY3RvciB7XG4gIC8qKiBTMyBidWNrZXQgKi9cbiAgcmVhZG9ubHkgYnVja2V0OiBzMy5JQnVja2V0O1xuXG4gIC8qKlxuICAgKiBEYXRhIGV2ZW50cyBmb3Igb2JqZWN0cyB3aG9zZSBrZXkgbWF0Y2hlcyB0aGlzIHByZWZpeCB3aWxsIGJlIGxvZ2dlZC5cbiAgICogQGRlZmF1bHQgLSBhbGwgb2JqZWN0c1xuICAgKi9cbiAgcmVhZG9ubHkgb2JqZWN0UHJlZml4Pzogc3RyaW5nO1xufVxuXG4vKipcbiAqIFJlc291cmNlIHR5cGUgZm9yIGEgZGF0YSBldmVudFxuICovXG5leHBvcnQgZW51bSBEYXRhUmVzb3VyY2VUeXBlIHtcbiAgLyoqXG4gICAqIERhdGEgcmVzb3VyY2UgdHlwZSBmb3IgTGFtYmRhIGZ1bmN0aW9uXG4gICAqL1xuICBMQU1CREFfRlVOQ1RJT04gPSAnQVdTOjpMYW1iZGE6OkZ1bmN0aW9uJyxcblxuICAvKipcbiAgICogRGF0YSByZXNvdXJjZSB0eXBlIGZvciBTMyBvYmplY3RzXG4gICAqL1xuICBTM19PQkpFQ1QgPSAnQVdTOjpTMzo6T2JqZWN0Jyxcbn1cblxuaW50ZXJmYWNlIEV2ZW50U2VsZWN0b3Ige1xuICByZWFkb25seSBpbmNsdWRlTWFuYWdlbWVudEV2ZW50cz86IGJvb2xlYW47XG4gIHJlYWRvbmx5IGV4Y2x1ZGVNYW5hZ2VtZW50RXZlbnRTb3VyY2VzPzogc3RyaW5nW107XG4gIHJlYWRvbmx5IHJlYWRXcml0ZVR5cGU/OiBSZWFkV3JpdGVUeXBlO1xuICByZWFkb25seSBkYXRhUmVzb3VyY2VzPzogRXZlbnRTZWxlY3RvckRhdGFbXTtcbn1cblxuaW50ZXJmYWNlIEV2ZW50U2VsZWN0b3JEYXRhIHtcbiAgcmVhZG9ubHkgdHlwZTogc3RyaW5nO1xuICByZWFkb25seSB2YWx1ZXM6IHN0cmluZ1tdO1xufVxuIl19